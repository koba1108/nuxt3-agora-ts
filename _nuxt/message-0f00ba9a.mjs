import{i as R,f,g as V,h as j,j as P,k as T,l as k,m as z,r as I,U as L,u as N,_ as H,n as J,p as q,q as G,o as c,c as i,a as o,s as x,v as S,F as b,t as w,x as m,y as E,b as K,w as Q,d as W,e as X}from"./entry-b7b28004.mjs";const Y=a=>R(a)?a:f(a),Z=()=>null;function $(a,r,t={}){var y,D,g,_,p;if(typeof a!="string")throw new TypeError("asyncData key must be a string");if(typeof r!="function")throw new TypeError("asyncData handler must be a function");t={server:!0,default:Z,...t},t.defer&&console.warn("[useAsyncData] `defer` has been renamed to `lazy`. Support for `defer` will be removed in RC."),t.lazy=(D=(y=t.lazy)!=null?y:t.defer)!=null?D:!1,t.initialCache=(g=t.initialCache)!=null?g:!0;const e=V(),d=k();if(d&&!d._nuxtOnBeforeMountCbs){const u=d._nuxtOnBeforeMountCbs=[];d&&(j(()=>{u.forEach(l=>{l()}),u.splice(0,u.length)}),P(()=>u.splice(0,u.length)))}const v=()=>t.initialCache&&e.payload.data[a]!==void 0,n={data:Y((_=e.payload.data[a])!=null?_:t.default()),pending:f(!v()),error:f((p=e.payload._errors[a])!=null?p:null)};n.refresh=(u={})=>e._asyncDataPromises[a]?e._asyncDataPromises[a]:u._initial&&v()?e.payload.data[a]:(n.pending.value=!0,e._asyncDataPromises[a]=Promise.resolve(r(e)).then(l=>{t.transform&&(l=t.transform(l)),t.pick&&(l=ee(l,t.pick)),n.data.value=l,n.error.value=null}).catch(l=>{n.error.value=l,n.data.value=z(t.default())}).finally(()=>{n.pending.value=!1,e.payload.data[a]=n.data.value,n.error.value&&(e.payload._errors[a]=!0),delete e._asyncDataPromises[a]}),e._asyncDataPromises[a]);const s=()=>n.refresh({_initial:!0}),C=t.server!==!1&&e.payload.serverRendered;{C&&e.isHydrating&&a in e.payload.data?n.pending.value=!1:d&&e.payload.serverRendered&&(e.isHydrating||t.lazy)?d._nuxtOnBeforeMountCbs.push(s):s(),t.watch&&T(t.watch,()=>n.refresh());const u=e.hook("app:data:refresh",l=>{if(!l||l.includes(a))return n.refresh()});d&&P(u)}const h=Promise.resolve(e._asyncDataPromises[a]).then(()=>n);return Object.assign(h,n),h}function ee(a,r){const t={};for(const e of r)t[e]=a[e];return t}const ae=(a,r)=>({id:L.generate(),username:a,text:r,createdAt:new Date().toLocaleString("ja-JP"),updatedAt:new Date().toLocaleString("ja-JP")}),te=a=>(r,t)=>a.value.push(ae(r,t)),re=a=>r=>a.value=r,se=a=>()=>a.value=[],ne=a=>{const r=N("chatRoom",()=>a||[]);return{messages:I(r),add:te(r),set:re(r),clear:se(r)}},ue=["asc","desc"],le=["id","username","createdAt","updatedAt"],oe=J({__name:"message",async setup(a,{expose:r}){r();let t,e;const{data:d,pending:v,error:n,refresh:s}=([t,e]=q(()=>$("messages",()=>$fetch("/api/messages"))),t=await t,e(),t),{messages:C,add:h,set:y,clear:D}=ne(d.value),g=f("\u30E6\u30FC\u30B6\u30FC1"),_=f(""),p=f("asc"),u=f("createdAt"),l=()=>{h(g.value,_.value),_.value=""},O=()=>{s(),y(d.value)},A=(B,M)=>{switch(p.value){case"asc":return B[u.value]<M[u.value]?1:-1;case"desc":return B[u.value]>M[u.value]?1:-1}},U=G(()=>C.value.map(B=>B).sort(A)),F={data:d,pending:v,error:n,refresh:s,messages:C,add:h,set:y,clear:D,username:g,text:_,orderBy:p,sortBy:u,addMessage:l,refreshMessages:O,_sort:A,sortMessages:U,AllMessageSortables:le,AllOrderBy:ue};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),de=o("h3",null,"\u30C1\u30E3\u30C3\u30C8",-1),ce={key:0},ie={key:1},fe={key:2},_e=o("h3",null,"\u30E1\u30C3\u30BB\u30FC\u30B8\u4E00\u89A7",-1),me=o("label",null,"\u30E6\u30FC\u30B6\u30FC\u540D",-1),ve=o("label",null,"\u30C6\u30AD\u30B9\u30C8",-1),he=["disabled"],ye=X("TOP\u3078");function ge(a,r,t,e,d,v){const n=W;return c(),i("div",null,[o("div",null,[de,x(o("select",{"onUpdate:modelValue":r[0]||(r[0]=s=>e.orderBy=s)},[(c(!0),i(b,null,w(e.AllOrderBy,s=>(c(),i("option",{key:s},m(s),1))),128))],512),[[S,e.orderBy]]),x(o("select",{"onUpdate:modelValue":r[1]||(r[1]=s=>e.sortBy=s)},[(c(!0),i(b,null,w(e.AllMessageSortables,s=>(c(),i("option",{key:s},m(s),1))),128))],512),[[S,e.sortBy]])]),e.error?(c(),i("div",ce,m(e.error),1)):e.pending?(c(),i("div",ie,"Loading...")):(c(),i("div",fe,[_e,(c(!0),i(b,null,w(e.sortMessages,s=>(c(),i("ul",{key:s.id},[o("li",null,m(s.username)+":\u300C"+m(s.text)+"\u300D\uFF08"+m(s.createdAt)+"\uFF09",1)]))),128))])),o("div",null,[me,x(o("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=s=>e.username=s),placeholder:"\u30E6\u30FC\u30B6\u30FC\u540D"},null,512),[[E,e.username]]),ve,x(o("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=s=>e.text=s),placeholder:"\u30C6\u30AD\u30B9\u30C8"},null,512),[[E,e.text]]),o("button",{disabled:!e.text||!e.username,onClick:e.addMessage},"\u8FFD\u52A0\u3059\u308B",8,he),o("button",{onClick:r[4]||(r[4]=(...s)=>e.clear&&e.clear(...s))},"\u521D\u671F\u5316\u3059\u308B"),o("button",{onClick:e.refreshMessages},"\u518D\u53D6\u5F97")]),K(n,{to:"/"},{default:Q(()=>[ye]),_:1})])}var Ce=H(oe,[["render",ge]]);export{Ce as default};
